{% extends 'layout.html' %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/apps/cargar_procedimiento.css') }}">
{% endblock %}
{% block content %}
<div class="cargar-procedimiento-container">
    <div class="cargar-procedimiento-header">
        <h3 class="mb-4">Cargar Procedimiento</h3>
    </div>

    <form method="POST">
        <!-- Controles globales -->
        <div class="cargar-procedimiento-controls d-flex flex-wrap align-items-center gap-3">
        <!-- Checkbox maestro -->
        <div class="form-check m-0">
            <input class="form-check-input" type="checkbox" id="selectAll">
            <label class="form-check-label fw-bold" for="selectAll">Seleccionar todo</label>
        </div>

            <!-- Botón expandir/colapsar -->
            <button type="button" class="btn btn-sm btn-outline-secondary" id="toggleAll">Expandir todo</button>
        </div>

        <div class="cargar-procedimiento-list">
            {% macro render_items(items, nivel=0, padre='root') %}
    <ul class="list-unstyled ps-{{ nivel * 3 }}">
        {% for item in items %}
        {% set id_unico = (padre ~ '_' ~ loop.index)|replace(' ', '_') %}
        <li class="mb-2">
            <div class="form-check d-flex align-items-center">
                <input class="form-check-input me-2" type="checkbox" name="seleccion" value="{{ item.nombre }}" id="chk_{{ id_unico }}">
                <label class="form-check-label me-2 nivel-texto-{{ nivel }}" for="chk_{{ id_unico }}">
                    {{ item.nombre }}
                </label>
                {% if item.submenues %}
                <button class="btn btn-sm toggle-btn nivel-boton-{{ nivel }}" type="button" data-bs-toggle="collapse" data-bs-target="#sub_{{ id_unico }}" aria-expanded="false" aria-controls="sub_{{ id_unico }}">
                    ▼
                </button>
                {% endif %}
            </div>
            {% if item.submenues %}
            <div class="collapse mt-2" id="sub_{{ id_unico }}">
                {{ render_items(item.submenues, nivel + 1, id_unico) }}
            </div>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% endmacro %}

            {{ render_items(data) }}
        </div>

        <div class="cargar-procedimiento-submit">
            <button type="submit" class="btn btn-primary">Generar Archivo</button>
        </div>
    </form>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/apps/cargar_procedimiento.js') }}"></script>
{% endblock %}
