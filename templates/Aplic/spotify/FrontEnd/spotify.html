{% extends 'layout.html' %}

{% block content %}
<h3 class="mb-3">Spotify de {{ spotify_user }}</h3>

{% if access_token %}

    <div class="mb-3">
        <button id="btnPlay" class="btn btn-primary me-2">‚ñ∂Ô∏è Play</button>
        <button id="btnPause" class="btn btn-secondary me-2">‚è∏ Pause</button>
        <button id="btnNext" class="btn btn-info">‚è≠ Next</button>
    </div>

    {% if playlists %}
        <div class="row">
            {% for playlist in playlists %}
                <div class="col-md-6 col-lg-4 mb-4">
                    <iframe style="border-radius:12px"
                            src="https://open.spotify.com/embed/playlist/{{ playlist.id }}"
                            width="100%"
                            height="380"
                            frameborder="0"
                            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                            loading="lazy">
                    </iframe>
                    <p class="mt-2 text-center">{{ playlist.name }}</p>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No se encontraron playlists guardadas.</p>
    {% endif %}
{% else %}
    <a href="{{ url_for('indexspotify.login_spotify') }}" class="btn btn-success">
        üéß Conectar con Spotify
    </a>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', () => {
    const playBtn = document.getElementById('btnPlay');
    const pauseBtn = document.getElementById('btnPause');
    const nextBtn = document.getElementById('btnNext');

    playBtn?.addEventListener('click', async () => {
        const res = await fetch('/spotify/play', {method: 'POST'});
        if (res.ok) alert('Reproducci√≥n iniciada');
        else alert('Error al iniciar reproducci√≥n');
    });

    pauseBtn?.addEventListener('click', async () => {
        const res = await fetch('/spotify/pause', {method: 'POST'});
        if (res.ok) alert('Reproducci√≥n pausada');
        else alert('Error al pausar reproducci√≥n');
    });

    nextBtn?.addEventListener('click', async () => {
        const res = await fetch('/spotify/next', {method: 'POST'});
        if (res.ok) alert('Siguiente canci√≥n');
        else alert('Error al pasar a la siguiente canci√≥n');
    });
});
</script>
{% endblock %}
