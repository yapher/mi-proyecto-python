<div id="totalGeneralTexto" class="mt-3" style="font-size: 1.2rem; font-weight: bold; color: #88c999;"></div>
<div id="desgloseRubros" class="mt-4"></div>
<div id="graficoRubros" style="width: 100%; max-width: 600px; height: 400px; margin-top: 30px;"></div>
<div id="graficoEstadoPago" style="width: 100%; max-width: 600px; height: 400px; margin-top: 30px;"></div>

<script>
  function mostrarRubros(rubros, pagos = []) {
    const divResumen = document.getElementById("desgloseRubros");
    const totalTexto = document.getElementById("totalGeneralTexto");

    divResumen.innerHTML = "<h4>Totales por Rubro</h4>";
    totalTexto.innerHTML = "";

    if (!rubros || Object.keys(rubros).length === 0) {
      divResumen.innerHTML += "<p>No hay datos.</p>";
      document.getElementById("graficoRubros").innerHTML = "";
      document.getElementById("graficoEstadoPago").innerHTML = "";
      return;
    }

    let totalGeneral = 0;
    let html = `<div class="table-responsive tabla-scroll">
                <table border="1" class="table table-hover table-striped table-dark align-middle w-100 mb-0">
                  <thead class="sticky-header">
                    <tr><th>Rubro</th><th>Total ($)</th></tr>
                  </thead>
                  <tbody>`;

    for (let rubro in rubros) {
      const valor = rubros[rubro];
      totalGeneral += valor;
      html += `<tr><td>${rubro}</td><td>${valor.toLocaleString('es-AR', { style: 'currency', currency: 'ARS' })}</td></tr>`;
    }

    html += `</tbody></table></div>`;
    divResumen.innerHTML += html;

    // ‚úÖ C√°lculo pagado y pendiente
    let totalPagado = 0;
    let totalPendiente = 0;
    pagos.forEach(p => {
      if (p.pagado) {
        totalPagado += p.importe;
      } else {
        totalPendiente += p.importe;
      }
    });

    // ‚úÖ Mostrar resumen general
    totalTexto.innerHTML = `
      üí∞ Total de todos los rubros: <span style="color: #ffffff;">
        ${totalGeneral.toLocaleString('es-AR', { style: 'currency', currency: 'ARS' })}
      </span><br>
      ‚úîÔ∏è Pagado: <span style="color: #88c999;">
        ${totalPagado.toLocaleString('es-AR', { style: 'currency', currency: 'ARS' })}
      </span><br>
      ‚ùå Pendiente: <span style="color: #f08080;">
        ${totalPendiente.toLocaleString('es-AR', { style: 'currency', currency: 'ARS' })}
      </span>`;

    mostrarGraficoRubros(rubros);
    mostrarGraficoEstadoPago(totalPagado, totalPendiente);
  }

  function mostrarGraficoRubros(rubros) {
    const chartDom = document.getElementById('graficoRubros');
    const myChart = echarts.init(chartDom);
    const data = Object.keys(rubros).map(rubro => ({
      name: rubro,
      value: rubros[rubro]
    }));

    const option = {
      title: {
        text: 'Distribuci√≥n por Rubros',
        left: 'center'
      },
      tooltip: {
        trigger: 'item',
        formatter: '{b}: ${c} ({d}%)'
      },
      legend: {
        orient: 'vertical',
        left: 'left'
      },
      series: [
        {
          name: 'Gastos',
          type: 'pie',
          radius: '60%',
          data: data,
          emphasis: {
            itemStyle: {
              shadowBlur: 10,
              shadowOffsetX: 0,
              shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
          },
          label: {
            formatter: '{b}\n${c} ({d}%)'
          }
        }
      ]
    };

    myChart.setOption(option);
  }

  function mostrarGraficoEstadoPago(pagado, pendiente) {
    const chartDom = document.getElementById('graficoEstadoPago');
    const myChart = echarts.init(chartDom);

    const option = {
      title: {
        text: 'Estado de Pagos',
        left: 'center'
      },
      tooltip: {
        trigger: 'item',
        formatter: '{b}: ${c} ({d}%)'
      },
      legend: {
        orient: 'horizontal',
        bottom: 0
      },
      series: [
        {
          name: 'Estado',
          type: 'pie',
          radius: ['40%', '70%'],
          avoidLabelOverlap: false,
          label: {
            formatter: '{b}\n${c} ({d}%)'
          },
          data: [
            { value: pagado, name: '‚úîÔ∏è Pagado' },
            { value: pendiente, name: '‚ùå Pendiente' }
          ]
        }
      ]
    };

    myChart.setOption(option);
  }
</script>

