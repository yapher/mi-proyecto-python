{% extends 'layout.html' %}
{% block content %}

<style>
  .canvas-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 80vh;
    width: 100%;
    padding: 10px;
  }
  .titulo-simulacion {
    margin-bottom: 20px;
    text-align: center;
    font-weight: bold;
    color: #00ffaa;
    text-shadow: 0 0 8px rgba(0, 255, 200, 0.6);
  }
  canvas {
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0, 255, 200, 0.4);
    max-width: 100%;
    height: auto;
    background-color: black;
  }
  #faceRecognitionSection {
    display: none;
    flex-direction: column;
    align-items: center;
  }
  @media (max-width: 768px) {
    .canvas-container {
      height: auto;
    }
    canvas {
      width: 100%;
      height: auto;
    }
  }
</style>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="alert alert-warning" role="alert">
      {% for message in messages %}
        {{ message }}
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Modal login visible siempre -->
<div id="loginModal">
  <form action="{{ url_for('login') }}" method="post" class="mb-3">
    <div class="mb-3">
      <label for="username" class="form-label">Usuario</label>
      <input type="text" id="username" name="username" class="form-control" required />
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">Contraseña</label>
      <input type="password" id="password" name="password" class="form-control" required />
    </div>
    <button type="submit" class="btn btn-primary">Ingresar</button>
  </form>
  <button id="showFaceRecBtn" class="btn btn-secondary mt-2">Usar reconocimiento facial</button>
</div>

<!-- Sección detección facial oculta inicialmente -->
<div id="faceRecognitionSection">
  <div class="canvas-container">
    <h3 class="titulo-simulacion">Simulación de Detección Facial</h3>
    <div id="fpsCounter" style="color: #00ffaa; font-weight: bold; font-size: 1.2rem; margin-bottom: 10px;"></div>
    <canvas id="outputCanvas"></canvas>
  </div>
  <button id="captureBtn" class="btn btn-success mb-3">Capturar Rostro</button>
  <video hidden id="inputVideo" autoplay muted></video>
</div>

{% if debug_info %}
  <div class="alert alert-info" role="alert" style="white-space: pre-line; max-height: 200px; overflow-y: auto;">
    {{ debug_info|join('\n') }}
  </div>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="/static/js/apps/login_facial.js"></script>

{% endblock %}
